
# 项目使用说明

## 环境准备
```shell
# 1.安装anaconda
   # 下载anacona，可以下载免费了，填入邮箱，然后通过邮箱收到的链接下载
   # 地址：https://www.anaconda.com/download
   
# 2.创建python环境
conda create -n graphrag python=3.10

# 3.激活环境
conda activate graphrag

# 4. 下载本项目
git clone https://github.com/YueZhengMeng/graphrag-learn
cd graphrag-learn

# 5. 安装graphrag所需环境
# 注意：windows平台安装去掉uvloop这个包
pip install -r requirements.txt
```

## 实例展示

### 准备数据集
《孔乙己》小说原文已存储在`data/kongyiji.txt`中，该文件为utf-8编码

### 初始化项目文件夹
```shell
mkdir -p ./kongyiji
python -m graphrag.index --init --root ./kongyiji
```

### 准备文本数据
```shell
mkdir -p ./kongyiji/input
cp data/kongyiji.txt ./kongyiji/input/
```

### 复制配置文件与中文prompts
```shell
cp extra_data/settings.yaml ./kongyiji
cp extra_data/claim_extraction_cn.txt ./kongyiji/prompts
cp extra_data/community_report_cn.txt ./kongyiji/prompts
cp extra_data/entity_extraction_cn.txt ./kongyiji/prompts
cp extra_data/global_map_system_prompt_cn.txt ./kongyiji/prompts
cp extra_data/global_reduce_system_prompt_cn.txt ./kongyiji/prompts
cp extra_data/local_query_prompt_cn.txt ./kongyiji/prompts
cp extra_data/summarize_descriptions_cn.txt ./kongyiji/prompts
```

### 构建索引
配置resume参数之后，失败了重新跑一遍就可以从断点继续，避免从头开始
```shell
python -m graphrag.index --root ./kongyiji --resume kongyiji -v
```

### 查询
通过--data指定读取哪个索引，否则会读取`kongyiji`目录下的第一个版本
#### 本地查询
```shell
python -m graphrag.query --root --data ./output/kongyiji/artifacts --method local "孔乙己与丁举人的关系"
```
#### 全局查询
```shell
python -m graphrag.query --root --data ./output/kongyiji/artifacts --method global "孔乙己与丁举人的关系"
```

### 知识图谱可视化
基于`pyvis`实现  
代码见`./visualize_graph/visualize_graph.ipynb`  
可视化结果可以直接在`Jupyter Notebook`界面查看，也可以用浏览器打开生成的html文件  
界面第一次显示有点慢，推测与某些必要的css与js文件在外网有关  
第一次显示后，当前路径下会出现`lib`文件夹，其中缓存了这些css与js文件  
确保`lib`文件夹与涉及`pyvis`的`ipynb`文件或`html`文件在同一文件夹下，之后的页面会自动加载这些文件，速度会变快  
鼠标放在节点或边上，会显示对应的详细信息  
节点可以拖动，拖动结束后会自动调整位置与图的形状

### 参考文档
https://gitee.com/open-llm/llm-graph-rag/blob/master/docs/%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.md
https://cloud.baidu.com/qianfandev/topic/361360
